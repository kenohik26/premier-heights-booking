<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier Heights Booking Manager - Enhanced Edition</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Chart.js for Reports -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <!-- EmailJS for Email Notifications -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        /* Premier Heights Brand Styles */
        :root {
            --brand-royal-blue: #2E3192;
            --brand-burnt-orange: #F15A29;
            --brand-light-orange: #F7941D;
            --brand-gray: #D1D3D4;
            --brand-black: #000000;
            --brand-white: #FFFFFF;
        }

        h1, h2, h3, h4, h5, h6, .section-title, .stat-value, .login-title {
            font-family: 'Museo', 'Raleway', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 700;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Login Page Styles */
        .login-wrapper {
            min-height: 100vh;
            background: linear-gradient(to bottom right, #eff6ff, #e0e7ff);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .login-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 28rem;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-icon {
            width: 4rem;
            height: 4rem;
            color: #2E3192;
            margin: 0 auto 1rem;
        }

        .login-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1f2937;
        }

        .login-subtitle {
            color: #6b7280;
            margin-top: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .form-input {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #2E3192;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-input:disabled {
            background-color: #f3f4f6;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #e95f89 0%, #edd02f 100%);
        }

        .btn-danger {
            color: white;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            padding: 0.5rem;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #ff5252 0%, #dd495e 100%);
        }

        .btn-edit {
            color: white;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 0.5rem;
        }

        .btn-edit:hover {
            background: linear-gradient(135deg, #3e9bed 0%, #00e1ed 100%);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
        }

        .btn-whatsapp:hover {
            background: linear-gradient(135deg, #20BA5A 0%, #0F7A6B 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
        }

        .btn-whatsapp svg {
            width: 18px;
            height: 18px;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .info-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .info-box p {
            margin-bottom: 0.5rem;
            color: #6b7280;
        }

        .info-box p:last-child {
            margin-bottom: 0;
        }

        .info-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        /* Main App Styles */
        .app-wrapper {
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .header {
            background-color: white;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #e5e7eb;
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-icon {
            width: 2rem;
            height: 2rem;
            color: #2E3192;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        .header-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            color: #374151;
            background: transparent;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .logout-btn:hover {
            background-color: #f3f4f6;
        }

        /* Navigation */
        .nav {
            background-color: white;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #e5e7eb;
        }

        .nav-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            gap: 2rem;
        }

        .nav-btn {
            padding: 1rem 0.5rem;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            color: #1f2937;
        }

        .nav-btn.active {
            border-bottom-color: #2E3192;
            color: #2E3192;
        }

        /* Main Content */
        .main-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2E3192 0%, #F15A29 100%);
        }

        .stat-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            color: white;
            border-radius: 1rem 1rem 0 0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .apartment-detail-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 20%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .booking-list-item {
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid #2E3192;
            transition: all 0.2s;
        }

        .booking-list-item:hover {
            background: #f3f4f6;
            transform: translateX(4px);
        }

        .stat-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 800;
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-icon {
            width: 3.5rem;
            height: 3.5rem;
            opacity: 0.15;
        }

        .stat-icon-indigo { color: #2E3192; }
        .stat-icon-green { color: #10b981; }
        .stat-icon-yellow { color: #f59e0b; }
        .stat-icon-blue { color: #4facfe; }

        /* Apartment Cards */
        .apartments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .apartment-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: none;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .apartment-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .apartment-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .apartment-name {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .apartment-bedrooms {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        .apartment-icon {
            width: 2.5rem;
            height: 2.5rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .apartment-price {
            margin-bottom: 1rem;
        }

        .price-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .price-value {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .booking-info {
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .booking-info-blue {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        }

        .booking-info-green {
            background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%);
        }
            background-color: #f0fdf4;
        }

        .booking-info-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .booking-info-guest {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
        }

        .booking-info-dates {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .available-text {
            font-size: 0.875rem;
            font-weight: 500;
            color: #059669;
        }

        .available-subtext {
            font-size: 0.75rem;
            color: #10b981;
        }

        .more-bookings {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 0.375rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
        }

        .status-confirmed {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            color: white;
        }

        .status-checked-in {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
        }

        .status-completed {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: white;
        }

        .status-cancelled {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            color: white;
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-section {
            margin-bottom: 1.5rem;
        }

        .calculation-box {
            background-color: #eef2ff;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .calculation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .calculation-item p:first-child {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .calculation-value {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .calc-gray { color: #1f2937; }
        .calc-indigo { color: #2E3192; }
        .calc-red { color: #dc2626; }
        .calc-green { color: #059669; }

        .form-buttons {
            display: flex;
            gap: 1rem;
        }

        .form-buttons .btn {
            flex: 1;
        }

        .form-input-full {
            width: 100%;
        }

        /* Filter Section */
        .filter-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
        }

        .search-wrapper {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            width: 1.25rem;
            height: 1.25rem;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #2E3192;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Booking List */
        .bookings-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .booking-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            border: none;
            padding: 1.75rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .booking-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #2E3192 0%, #F15A29 100%);
        }

        .booking-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transform: translateX(4px);
        }

        .booking-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .booking-header-left {
            flex: 1;
        }

        .booking-name-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .booking-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        .booking-apartment {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        .booking-actions {
            display: flex;
            gap: 0.5rem;
        }

        .booking-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .detail-value {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
            margin-top: 0.25rem;
        }

        .payment-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
        }

        .payment-total { color: #2E3192; }
        .payment-paid { color: #059669; }

        .notes-box {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: #eff6ff;
            border-radius: 0.5rem;
        }

        .notes-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .notes-text {
            font-size: 0.875rem;
            color: #374151;
        }

        .booking-meta {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.75rem;
        }

        .empty-state {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 3rem;
            text-align: center;
        }

        .empty-icon {
            width: 4rem;
            height: 4rem;
            color: #d1d5db;
            margin: 0 auto 1rem;
        }

        .empty-text {
            color: #6b7280;
        }

        /* Apartment Management */
        .manage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .manage-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
        }

        .manage-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .manage-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .manage-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .manage-icon {
            width: 2.5rem;
            height: 2.5rem;
            color: #2E3192;
        }

        .price-input-group {
            margin-bottom: 1rem;
        }

        .price-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dollar-sign {
            color: #6b7280;
        }

        .price-help {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .stats-item p:first-child {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .stats-item p:last-child {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .stats-gray { color: #1f2937; }
        .stats-green { color: #059669; }
        .stats-indigo { color: #2E3192; }

        select {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            background-color: white;
        }

        select:focus {
            outline: none;
            border-color: #2E3192;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        textarea {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #2E3192;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Calendar Styles */
        .calendar-container {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: none;
            padding: 2rem;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #f3f4f6;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .calendar-month {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calendar-nav {
            display: flex;
            gap: 0.75rem;
        }

        .calendar-nav-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 600;
            color: #374151;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .calendar-nav-btn:hover {
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .calendar-filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s;
            color: #374151;
        }

        .calendar-filter-btn:hover {
            border-color: #2E3192;
            background: #f9fafb;
        }

        .calendar-filter-btn.active {
            border-color: #2E3192;
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            color: white;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 700;
            font-size: 0.875rem;
            color: #6b7280;
            padding: 1rem 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-day {
            min-height: 120px;
            border: 2px solid #f3f4f6;
            border-radius: 0.75rem;
            padding: 0.75rem;
            background: white;
            position: relative;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            border-color: #e5e7eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        .calendar-day.other-month {
            background: #fafafa;
            opacity: 0.4;
        }

        .calendar-day.today {
            border-color: #2E3192;
            border-width: 3px;
            background: linear-gradient(135deg, #f9fafb 0%, #eef2ff 100%);
        }

        .calendar-day.weekend {
            background: #fffbeb;
        }

        .calendar-day.weekend.other-month {
            background: #fefce8;
            opacity: 0.4;
        }

        .calendar-date {
            font-size: 1rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .booking-count-badge {
            background: linear-gradient(135deg, #2E3192 0%, #F15A29 100%);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-weight: 700;
        }

        .calendar-booking {
            font-size: 0.75rem;
            padding: 0.4rem 0.6rem;
            border-radius: 0.5rem;
            margin-bottom: 0.35rem;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
            transition: all 0.2s;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .calendar-booking:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .calendar-booking.green { 
            background: linear-gradient(135deg, #e6f7e6 0%, #b3e6b3 100%); 
            color: #006600; 
            border-left: 3px solid #00B000;
        }
        .calendar-booking.orange { 
            background: linear-gradient(135deg, #ffe6d9 0%, #ffccb3 100%); 
            color: #7d3600; 
            border-left: 3px solid #F76B00;
        }
        .calendar-booking.blue { 
            background: linear-gradient(135deg, #e6ecff 0%, #b3c7ff 100%); 
            color: #001a9e; 
            border-left: 3px solid #0025F7;
        }
        .calendar-booking.yellow { 
            background: linear-gradient(135deg, #fffee6 0%, #fffdb3 100%); 
            color: #7d7700; 
            border-left: 3px solid #F7EF00;
        }

        /* Half-day checkout styling - shows only morning */
        .calendar-booking.checkout {
            background: linear-gradient(90deg, currentColor 0%, currentColor 50%, transparent 50%, transparent 100%);
            padding-left: 0.4rem;
        }

        .calendar-booking.checkout::after {
            content: '‚òÄÔ∏è';
            position: absolute;
            right: 0.4rem;
            font-size: 0.7rem;
        }

        .calendar-booking.checkin::after {
            content: 'üåô';
            position: absolute;
            right: 0.4rem;
            font-size: 0.7rem;
        }

        .calendar-booking.pending {
            opacity: 0.7;
            border-style: dashed;
        }

        .calendar-legend {
            display: flex;
            gap: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 0.75rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 0.375rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
            height: 20px;
            border-radius: 0.25rem;
        }

        /* Reports Styles */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .report-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
        }

        .report-card-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 1rem;
        }

        .report-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        .report-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2E3192;
            margin: 0.5rem 0;
        }

        .report-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .chart-container {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .btn-export {
            background: #059669;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-export:hover {
            background: #047857;
        }

        /* Photo Upload Styles */
        .photo-upload-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .photo-upload-box {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload-box:hover {
            border-color: #2E3192;
            background: #f9fafb;
        }

        .photo-upload-box.has-photo {
            border-style: solid;
            border-color: #10b981;
        }

        .photo-preview {
            width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 0.25rem;
            margin-top: 0.5rem;
        }

        .photo-upload-input {
            display: none;
        }

        .photo-upload-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        /* Guest History Styles */
        .guest-history-popup {
            position: absolute;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            z-index: 100;
            max-width: 300px;
            margin-top: 0.5rem;
        }

        .guest-history-title {
            font-weight: 600;
            font-size: 0.875rem;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .guest-history-item {
            font-size: 0.75rem;
            color: #6b7280;
            padding: 0.25rem 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .guest-history-item:last-child {
            border-bottom: none;
        }

        /* Activity Log Styles */
        .activity-log {
            background: #f9fafb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .activity-log-title {
            font-weight: 600;
            font-size: 0.875rem;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .activity-item {
            font-size: 0.75rem;
            color: #6b7280;
            padding: 0.5rem;
            background: white;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .activity-item:last-child {
            margin-bottom: 0;
        }

        .activity-time {
            color: #9ca3af;
            font-size: 0.7rem;
        }

        /* Reminder Badges */
        .reminder-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .reminder-checkin-today {
            background: #dbeafe;
            color: #1e40af;
        }

        .reminder-checkout-soon {
            background: #fef3c7;
            color: #92400e;
        }

        .reminder-overdue {
            background: #fee2e2;
            color: #991b1b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .calculation-grid {
                grid-template-columns: 1fr;
            }

            .payment-grid {
                grid-template-columns: 1fr;
            }

            .manage-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .apartments-grid {
                grid-template-columns: 1fr;
            }

            .stats-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Calendar = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                <line x1="16" x2="16" y1="2" y2="6"/>
                <line x1="8" x2="8" y1="2" y2="6"/>
                <line x1="3" x2="21" y1="10" y2="10"/>
            </svg>
        );

        const Home = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
        );

        const Users = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );

        const DollarSign = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" x2="12" y1="2" y2="22"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );

        const Plus = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M5 12h14"/>
                <path d="M12 5v14"/>
            </svg>
        );

        const Edit2 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                <path d="m15 5 4 4"/>
            </svg>
        );

        const Trash2 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" x2="10" y1="11" y2="17"/>
                <line x1="14" x2="14" y1="11" y2="17"/>
            </svg>
        );

        const LogOut = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" x2="9" y1="12" y2="12"/>
            </svg>
        );

        const Search = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.3-4.3"/>
            </svg>
        );

        // Aliases for consistency
        const Edit = Edit2;
        const Trash = Trash2;

        const MessageCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
            </svg>
        );

        // Initial data
        const INITIAL_APARTMENTS = [
            { id: 1, name: 'Green', bedrooms: 3, pricePerNight: 150000 },
            { id: 2, name: 'Orange', bedrooms: 3, pricePerNight: 150000 },
            { id: 3, name: 'Blue', bedrooms: 3, pricePerNight: 150000 },
            { id: 4, name: 'Yellow', bedrooms: 3, pricePerNight: 150000 }
        ];

        const INITIAL_USERS = [
            { id: 1, username: 'admin1', password: 'admin123', role: 'admin', name: 'Kenneth' },
            { id: 2, username: 'admin2', password: 'admin123', role: 'admin', name: 'Zainab' },
            { id: 3, username: 'viewer', password: 'viewer123', role: 'viewer', name: 'Manager' }
        ];

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // TODO: Replace with your Firebase config from Firebase Console
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        let database, storage;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            database = firebase.database();
            storage = firebase.storage();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            alert('Firebase configuration error. Please check your firebaseConfig settings.');
        }

        // Initialize EmailJS
        // TODO: Replace with your EmailJS credentials from https://www.emailjs.com/
        // Create a free account, get your Public Key, and create an email template
        const EMAILJS_PUBLIC_KEY = "YOUR_EMAILJS_PUBLIC_KEY";
        const EMAILJS_SERVICE_ID = "YOUR_SERVICE_ID";
        const EMAILJS_TEMPLATE_ID = "YOUR_TEMPLATE_ID";
        
        if (typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY !== "YOUR_EMAILJS_PUBLIC_KEY") {
            emailjs.init(EMAILJS_PUBLIC_KEY);
        }

        // Email notification function
        const sendBookingNotification = async (booking, action) => {
            if (typeof emailjs === 'undefined' || EMAILJS_PUBLIC_KEY === "YOUR_EMAILJS_PUBLIC_KEY") {
                console.log('EmailJS not configured. Skipping email notification.');
                return;
            }

            try {
                const templateParams = {
                    to_email: "your-email@example.com", // Replace with actual email
                    guest_name: booking.guestName,
                    apartment: booking.apartmentName || `Apartment ${booking.apartmentId}`,
                    check_in: new Date(booking.checkIn).toLocaleDateString(),
                    check_out: new Date(booking.checkOut).toLocaleDateString(),
                    action: action, // "created", "updated", "cancelled"
                    status: booking.status,
                    contact: booking.contact
                };

                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
                console.log('Email notification sent successfully');
            } catch (error) {
                console.error('Failed to send email notification:', error);
            }
        };

        function BookingManager() {
            const [currentUser, setCurrentUser] = useState(null);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            // Initial state with apartments pre-loaded
            const [apartments, setApartments] = useState(INITIAL_APARTMENTS);
            const [bookings, setBookings] = useState([]);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showBookingForm, setShowBookingForm] = useState(false);
            const [editingBooking, setEditingBooking] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('all');
            const [filterApartment, setFilterApartment] = useState('all');

            const [bookingForm, setBookingForm] = useState({
                apartmentId: '',
                bookingType: 'agent', // 'agent' or 'direct'
                guestName: '',
                agentName: '',
                contact: '',
                idNumber: '',
                checkIn: '',
                checkOut: '',
                discountPerDay: 0, // Daily discount for long-term bookings
                paymentConfirmation: '',
                amountPaid: '',
                totalAmount: '',
                status: 'pending',
                notes: ''
            });

            // Calendar state
            const [calendarDate, setCalendarDate] = useState(new Date());
            const [selectedBooking, setSelectedBooking] = useState(null);
            const [apartmentFilter, setApartmentFilter] = useState('all');

            // Reports state  
            const [reportDateRange, setReportDateRange] = useState({
                start: new Date(new Date().getFullYear(), 0, 1).toISOString().split('T')[0],
                end: new Date().toISOString().split('T')[0]
            });

            // Modal states for dashboard cards
            const [showApartmentsModal, setShowApartmentsModal] = useState(false);
            const [showActiveBookingsModal, setShowActiveBookingsModal] = useState(false);
            const [showRevenueModal, setShowRevenueModal] = useState(false);
            const [selectedApartmentId, setSelectedApartmentId] = useState(null);

            // Expense state
            const [expenses, setExpenses] = useState([]);
            const [showExpenseForm, setShowExpenseForm] = useState(false);
            const [editingExpense, setEditingExpense] = useState(null);
            const [expenseForm, setExpenseForm] = useState({
                apartmentId: '',
                expenseType: 'electricity',
                description: '',
                amount: '',
                date: new Date().toISOString().split('T')[0],
                notes: ''
            });

            // WhatsApp Settings
            const [whatsappSettings, setWhatsappSettings] = useState({
                propertyAddress: `Premier Heights
Adeniyi Coker Street
Off Ty Danjuma Street
Dideolu Estate, Victoria Island
Lagos, Nigeria`,
                googleMapsLink: 'https://maps.google.com/?q=Premier+Heights+Adeniyi+Coker+Street+Victoria+Island+Lagos',
                contactName: 'David',
                contactNumber: '09049675453',
                checkInTime: '2:00 PM',
                checkOutTime: '12:00 PM (Noon)',
                checkInInstructions: `1. Call David upon arrival at 09049675453
2. Keys will be handed over at the property
3. Please inspect the apartment and report any issues immediately
4. Enjoy your stay!`
            });

            useEffect(() => {
                loadData();
                
                // Check for saved login
                const savedUser = localStorage.getItem('premierHeightsUser');
                if (savedUser) {
                    try {
                        const user = JSON.parse(savedUser);
                        // Verify user still exists in INITIAL_USERS
                        const validUser = INITIAL_USERS.find(u => u.id === user.id);
                        if (validUser) {
                            setCurrentUser(validUser);
                        } else {
                            // User no longer valid, clear storage
                            localStorage.removeItem('premierHeightsUser');
                        }
                    } catch (error) {
                        console.error('Error loading saved login:', error);
                        localStorage.removeItem('premierHeightsUser');
                    }
                }
                
                return () => {
                    // Cleanup listeners when component unmounts
                    if (database) {
                        database.ref('apartments').off();
                        database.ref('bookings').off();
                    }
                };
            }, []);

            const loadData = async () => {
                try {
                    if (!database) {
                        console.error('Firebase not initialized');
                        setApartments(INITIAL_APARTMENTS);
                        return;
                    }

                    // Initialize apartments if they don't exist
                    const apartmentsRef = database.ref('apartments');
                    const apartmentsSnapshot = await apartmentsRef.once('value');
                    
                    if (!apartmentsSnapshot.exists()) {
                        // First time setup - save initial apartments
                        const aptData = {};
                        INITIAL_APARTMENTS.forEach(apt => {
                            aptData[apt.id] = apt;
                        });
                        await apartmentsRef.set(aptData);
                    }

                    // Listen to apartments changes
                    apartmentsRef.on('value', (snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            console.log('Apartments from Firebase:', data);
                            const apartmentsList = Object.keys(data).map(key => ({
                                ...data[key],
                                id: parseInt(key)
                            }));
                            console.log('Parsed apartments:', apartmentsList);
                            setApartments(apartmentsList);
                        } else {
                            console.log('No apartments in Firebase, using initial data');
                            setApartments(INITIAL_APARTMENTS);
                        }
                    });

                    // Listen to bookings changes
                    const bookingsRef = database.ref('bookings');
                    bookingsRef.on('value', (snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            const bookingsList = Object.keys(data).map(key => ({
                                ...data[key],
                                id: key
                            }));
                            setBookings(bookingsList);
                        } else {
                            setBookings([]);
                        }
                    });

                    // Listen to expenses changes
                    const expensesRef = database.ref('expenses');
                    expensesRef.on('value', (snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            const expensesList = Object.keys(data).map(key => ({
                                ...data[key],
                                id: key
                            }));
                            setExpenses(expensesList);
                        } else {
                            setExpenses([]);
                        }
                    });

                } catch (error) {
                    console.error('Failed to load data:', error);
                    setApartments(INITIAL_APARTMENTS);
                    setBookings([]);
                    setExpenses([]);
                }
            };

            // Firebase no longer needs saveData function - writes happen directly

            const handleLogin = (e) => {
                e.preventDefault();
                const user = INITIAL_USERS.find(
                    u => u.username === loginForm.username && u.password === loginForm.password
                );
                if (user) {
                    setCurrentUser(user);
                    // Save to localStorage for auto-login
                    localStorage.setItem('premierHeightsUser', JSON.stringify(user));
                    setLoginForm({ username: '', password: '' });
                } else {
                    alert('Invalid credentials');
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setActiveTab('dashboard');
                // Clear saved login
                localStorage.removeItem('premierHeightsUser');
            };

            const calculateNights = (checkIn, checkOut) => {
                if (!checkIn || !checkOut) return 0;
                const start = new Date(checkIn);
                const end = new Date(checkOut);
                const nights = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                return nights > 0 ? nights : 0;
            };

            const calculateTotalAmount = () => {
                if (bookingForm.apartmentId && bookingForm.checkIn && bookingForm.checkOut) {
                    const nights = calculateNights(bookingForm.checkIn, bookingForm.checkOut);
                    // Agent bookings: ‚Ç¶180,000/night, Direct bookings: ‚Ç¶200,000/night
                    const basePrice = bookingForm.bookingType === 'direct' ? 200000 : 180000;
                    const discount = parseFloat(bookingForm.discountPerDay) || 0;
                    const pricePerNight = Math.max(0, basePrice - discount); // Ensure price doesn't go negative
                    return pricePerNight * nights;
                }
                return 0;
            };

            const checkDoubleBooking = (apartmentId, checkIn, checkOut, excludeBookingId = null) => {
                return bookings.some(booking => {
                    if (booking.id === excludeBookingId) return false;
                    if (booking.apartmentId !== apartmentId) return false;
                    if (booking.status === 'cancelled') return false;

                    const bookingStart = new Date(booking.checkIn);
                    const bookingEnd = new Date(booking.checkOut);
                    const newStart = new Date(checkIn);
                    const newEnd = new Date(checkOut);

                    return (newStart < bookingEnd && newEnd > bookingStart);
                });
            };

            const handleBookingSubmit = async (e) => {
                e.preventDefault();
                
                console.log('Starting booking submission...');
                console.log('Current user:', currentUser);
                console.log('Booking form data:', bookingForm);

                const totalAmount = calculateTotalAmount();
                console.log('Calculated total amount:', totalAmount);
                
                if (checkDoubleBooking(
                    parseInt(bookingForm.apartmentId),
                    bookingForm.checkIn,
                    bookingForm.checkOut,
                    editingBooking?.id
                )) {
                    alert('This apartment is already booked for the selected dates. Please choose different dates.');
                    return;
                }

                const bookingData = {
                    ...bookingForm,
                    apartmentId: parseInt(bookingForm.apartmentId),
                    totalAmount,
                    amountPaid: parseFloat(bookingForm.amountPaid) || 0,
                    updatedAt: new Date().toISOString(),
                    updatedBy: currentUser.name
                };

                console.log('Booking data to save:', bookingData);

                try {
                    if (!database) {
                        throw new Error('Firebase database not initialized');
                    }

                    if (editingBooking) {
                        console.log('Updating existing booking:', editingBooking.id);
                        await database.ref(`bookings/${editingBooking.id}`).update(bookingData);
                        console.log('Booking updated successfully');
                    } else {
                        console.log('Creating new booking...');
                        bookingData.createdAt = new Date().toISOString();
                        bookingData.createdBy = currentUser.name;
                        const newBookingRef = database.ref('bookings').push();
                        console.log('New booking ref:', newBookingRef.key);
                        await newBookingRef.set(bookingData);
                        console.log('Booking created successfully with ID:', newBookingRef.key);
                        
                        // Try to send email notification
                        try {
                            await sendBookingNotification(bookingData, 'created');
                        } catch (emailError) {
                            console.log('Email notification skipped:', emailError.message);
                        }
                    }
                    
                    alert('Booking saved successfully!');
                    setShowBookingForm(false);
                    setEditingBooking(null);
                    setBookingForm({
                        apartmentId: '',
                        bookingType: 'agent',
                        guestName: '',
                        agentName: '',
                        contact: '',
                        idNumber: '',
                        checkIn: '',
                        checkOut: '',
                        discountPerDay: 0,
                        paymentConfirmation: '',
                        amountPaid: '',
                        totalAmount: '',
                        status: 'pending',
                        notes: ''
                    });
                } catch (error) {
                    console.error('Error saving booking:', error);
                    console.error('Error details:', error.message, error.code);
                    alert(`Failed to save booking: ${error.message}\n\nCheck console for details.`);
                }
            };

            const handleDeleteBooking = async (id) => {
                if (window.confirm('Are you sure you want to delete this booking?')) {
                    try {
                        await database.ref(`bookings/${id}`).remove();
                    } catch (error) {
                        console.error('Error deleting booking:', error);
                        alert('Failed to delete booking. Please try again.');
                    }
                }
            };

            const handleEditBooking = (booking) => {
                setEditingBooking(booking);
                setBookingForm(booking);
                setShowBookingForm(true);
                setActiveTab('bookings');
            };

            const handleDuplicateBooking = (booking) => {
                // Copy booking details but clear dates and status
                setBookingForm({
                    apartmentId: booking.apartmentId,
                    bookingType: booking.bookingType || 'agent',
                    guestName: booking.guestName,
                    agentName: booking.agentName,
                    contact: booking.contact,
                    idNumber: booking.idNumber,
                    checkIn: '',
                    checkOut: '',
                    discountPerDay: booking.discountPerDay || 0,
                    paymentConfirmation: '',
                    amountPaid: '',
                    totalAmount: '',
                    status: 'pending',
                    notes: booking.notes || ''
                });
                setEditingBooking(null);
                setShowBookingForm(true);
                setActiveTab('bookings');
            };

            const handleQuickStatusUpdate = async (bookingId, newStatus) => {
                try {
                    await database.ref(`bookings/${bookingId}`).update({
                        status: newStatus,
                        updatedAt: new Date().toISOString(),
                        updatedBy: currentUser.name
                    });
                    console.log(`Status updated to ${newStatus} for booking ${bookingId}`);
                } catch (error) {
                    console.error('Error updating status:', error);
                    alert('Failed to update status. Please try again.');
                }
            };

            // Expense Management Functions
            const handleExpenseSubmit = async (e) => {
                console.log('=== EXPENSE SUBMIT HANDLER CALLED ===');
                e.preventDefault();
                
                console.log('Submitting expense:', expenseForm);
                
                if (!database) {
                    alert('Database not connected. Please refresh the page.');
                    return;
                }
                
                try {
                    const expenseData = {
                        ...expenseForm,
                        apartmentId: expenseForm.apartmentId === 'general' ? 'general' : parseInt(expenseForm.apartmentId),
                        amount: parseFloat(expenseForm.amount),
                        createdAt: editingExpense ? editingExpense.createdAt : new Date().toISOString(),
                        createdBy: editingExpense ? editingExpense.createdBy : currentUser.name,
                        updatedAt: new Date().toISOString(),
                        updatedBy: currentUser.name
                    };

                    console.log('Saving expense data:', expenseData);

                    if (editingExpense) {
                        await database.ref(`expenses/${editingExpense.id}`).update(expenseData);
                        console.log('Expense updated successfully');
                    } else {
                        const newExpenseRef = await database.ref('expenses').push(expenseData);
                        console.log('Expense created successfully with ID:', newExpenseRef.key);
                    }

                    setShowExpenseForm(false);
                    setEditingExpense(null);
                    setExpenseForm({
                        apartmentId: '',
                        expenseType: 'electricity',
                        description: '',
                        amount: '',
                        date: new Date().toISOString().split('T')[0],
                        notes: ''
                    });
                } catch (error) {
                    console.error('Error saving expense:', error);
                    console.error('Error details:', error.message, error.code);
                    alert(`Failed to save expense: ${error.message}\n\nCheck console for details. You may need to update Firebase rules.`);
                }
            };

            const handleDeleteExpense = async (id) => {
                if (window.confirm('Are you sure you want to delete this expense?')) {
                    try {
                        await database.ref(`expenses/${id}`).remove();
                    } catch (error) {
                        console.error('Error deleting expense:', error);
                        alert('Failed to delete expense. Please try again.');
                    }
                }
            };

            const handleEditExpense = (expense) => {
                setEditingExpense(expense);
                setExpenseForm(expense);
                setShowExpenseForm(true);
            };

            // WhatsApp Integration Functions
            const generateWhatsAppMessage = (booking) => {
                const apartment = apartments.find(a => a.id === booking.apartmentId);
                const checkInDate = new Date(booking.checkIn).toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                const checkOutDate = new Date(booking.checkOut).toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                const recipientName = booking.bookingType === 'agent' && booking.agentName 
                    ? booking.agentName 
                    : booking.guestName;

                const balance = booking.totalAmount - (booking.amountPaid || 0);

                const message = `üè† *Premier Heights Booking Confirmed*

Hello ${recipientName}!

Your booking is confirmed:

üìç *Address:*
${whatsappSettings.propertyAddress}
${whatsappSettings.googleMapsLink}

üìÖ *Check-in:* 
${checkInDate} at ${whatsappSettings.checkInTime}

üìÖ *Check-out:* 
${checkOutDate} at ${whatsappSettings.checkOutTime}

üìû *Contact on Arrival:*
${whatsappSettings.contactName}: ${whatsappSettings.contactNumber}

üè† *Apartment:* ${apartment?.name} Apartment

${booking.bookingType === 'agent' ? `üë§ *Guest Name:* ${booking.guestName}\n` : ''}
üí∞ *Total Amount:* ‚Ç¶${booking.totalAmount.toLocaleString()}
üí≥ *Amount Paid:* ‚Ç¶${(booking.amountPaid || 0).toLocaleString()}
${balance > 0 ? `üíµ *Balance Due:* ‚Ç¶${balance.toLocaleString()}\n` : '‚úÖ *Fully Paid*\n'}
üîë *Check-in Instructions:*
${whatsappSettings.checkInInstructions}

Thank you for choosing Premier Heights! üéâ

_This is an automated message from Premier Heights Booking Manager_`;

                return encodeURIComponent(message);
            };

            const sendWhatsAppMessage = (booking) => {
                // Determine recipient phone number (agent or guest)
                const phoneNumber = booking.bookingType === 'agent' && booking.agentName
                    ? booking.contact // Use contact field which should have agent's number
                    : booking.contact; // Use guest's contact number
                
                if (!phoneNumber) {
                    alert('No phone number found for this booking. Please add a contact number first.');
                    return;
                }

                // Clean phone number (remove spaces, dashes, etc)
                const cleanNumber = phoneNumber.replace(/\D/g, '');
                
                // Generate message
                const message = generateWhatsAppMessage(booking);
                
                // Create WhatsApp URL
                const whatsappUrl = `https://wa.me/${cleanNumber}?text=${message}`;
                
                // Open in new window
                window.open(whatsappUrl, '_blank');
            };

            const updateApartmentPrice = async (id, newPrice) => {
                try {
                    await database.ref(`apartments/${id}/pricePerNight`).set(parseFloat(newPrice));
                } catch (error) {
                    console.error('Error updating price:', error);
                    alert('Failed to update price. Please try again.');
                }
            };

            const getApartmentBookings = (apartmentId) => {
                const now = new Date();
                return bookings.filter(b => 
                    b.apartmentId === apartmentId && 
                    b.status !== 'cancelled' &&
                    new Date(b.checkOut) >= now
                );
            };

            // Calendar helper functions
            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();
                
                const days = [];
                
                // Add empty slots for days before month starts
                for (let i = 0; i < startingDayOfWeek; i++) {
                    const prevMonthDay = new Date(year, month, -startingDayOfWeek + i + 1);
                    const dayOfWeek = prevMonthDay.getDay();
                    days.push({ 
                        date: prevMonthDay, 
                        isCurrentMonth: false,
                        isWeekend: dayOfWeek === 0 || dayOfWeek === 6
                    });
                }
                
                // Add days of current month
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDate = new Date(year, month, day);
                    const dayOfWeek = currentDate.getDay();
                    days.push({ 
                        date: currentDate, 
                        isCurrentMonth: true,
                        isWeekend: dayOfWeek === 0 || dayOfWeek === 6
                    });
                }
                
                // Add days to complete the week
                const remainingDays = 7 - (days.length % 7);
                if (remainingDays < 7) {
                    for (let i = 1; i <= remainingDays; i++) {
                        const nextMonthDay = new Date(year, month + 1, i);
                        const dayOfWeek = nextMonthDay.getDay();
                        days.push({ 
                            date: nextMonthDay, 
                            isCurrentMonth: false,
                            isWeekend: dayOfWeek === 0 || dayOfWeek === 6
                        });
                    }
                }
                
                return days;
            };

            const getBookingsForDate = (date, filterApartmentId = null) => {
                const targetDate = new Date(date);
                targetDate.setHours(0, 0, 0, 0);
                
                return bookings.filter(booking => {
                    const checkIn = new Date(booking.checkIn);
                    const checkOut = new Date(booking.checkOut);
                    checkIn.setHours(0, 0, 0, 0);
                    checkOut.setHours(0, 0, 0, 0);
                    
                    const isInDateRange = targetDate >= checkIn && targetDate <= checkOut && booking.status !== 'cancelled';
                    const matchesFilter = !filterApartmentId || filterApartmentId === 'all' || booking.apartmentId === parseInt(filterApartmentId);
                    
                    return isInDateRange && matchesFilter;
                }).map(booking => {
                    const checkIn = new Date(booking.checkIn);
                    const checkOut = new Date(booking.checkOut);
                    checkIn.setHours(0, 0, 0, 0);
                    checkOut.setHours(0, 0, 0, 0);
                    
                    // Determine if this is check-in day, check-out day, or full stay
                    const isCheckInDay = targetDate.getTime() === checkIn.getTime();
                    const isCheckOutDay = targetDate.getTime() === checkOut.getTime();
                    
                    return {
                        ...booking,
                        displayType: isCheckOutDay ? 'checkout' : (isCheckInDay ? 'checkin' : 'fullstay')
                    };
                });
            };

            const getApartmentColor = (aptId) => {
                const apartment = apartments.find(a => a.id === parseInt(aptId));
                if (!apartment) return 'gray';
                return apartment.name.toLowerCase();
            };

            // Reports helper functions
            const calculateMonthlyRevenue = () => {
                const revenueByMonth = {};
                bookings.forEach(booking => {
                    if (booking.status !== 'cancelled') {
                        const month = new Date(booking.checkIn).toLocaleDateString('en', { year: 'numeric', month: 'short' });
                        revenueByMonth[month] = (revenueByMonth[month] || 0) + (booking.amountPaid || 0);
                    }
                });
                return revenueByMonth;
            };

            const calculateOccupancyRate = () => {
                const today = new Date();
                const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                
                let totalNights = 0;
                let bookedNights = 0;
                
                apartments.forEach(apt => {
                    totalNights += 30; // 30 days per apartment
                    
                    bookings.forEach(booking => {
                        if (booking.apartmentId === apt.id && booking.status !== 'cancelled') {
                            const checkIn = new Date(booking.checkIn);
                            const checkOut = new Date(booking.checkOut);
                            
                            if (checkOut >= thirtyDaysAgo && checkIn <= today) {
                                const start = checkIn > thirtyDaysAgo ? checkIn : thirtyDaysAgo;
                                const end = checkOut < today ? checkOut : today;
                                const nights = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                                bookedNights += Math.max(0, nights);
                            }
                        }
                    });
                });
                
                return totalNights > 0 ? ((bookedNights / totalNights) * 100).toFixed(1) : 0;
            };

            const exportToExcel = () => {
                const exportData = filteredBookings.map(booking => {
                    const apartment = apartments.find(a => a.id === booking.apartmentId);
                    return {
                        'Guest Name': booking.guestName,
                        'Apartment': apartment?.name || booking.apartmentId,
                        'Agent': booking.agentName,
                        'Contact': booking.contact,
                        'Check-In': new Date(booking.checkIn).toLocaleDateString(),
                        'Check-Out': new Date(booking.checkOut).toLocaleDateString(),
                        'Status': booking.status,
                        'Total Amount': booking.totalAmount,
                        'Amount Paid': booking.amountPaid,
                        'Balance': booking.totalAmount - booking.amountPaid,
                        'Payment Confirmation': booking.paymentConfirmation || '',
                        'Created By': booking.createdBy || '',
                        'Created At': booking.createdAt ? new Date(booking.createdAt).toLocaleString() : ''
                    };
                });

                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Bookings");
                XLSX.writeFile(wb, `Premier_Heights_Bookings_${new Date().toISOString().split('T')[0]}.xlsx`);
            };

            const isAdmin = currentUser?.role === 'admin';

            const filteredBookings = bookings.filter(booking => {
                const matchesSearch = 
                    booking.guestName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    booking.contact.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    booking.agentName.toLowerCase().includes(searchTerm.toLowerCase());
                
                const matchesStatus = filterStatus === 'all' || booking.status === filterStatus;
                const matchesApartment = filterApartment === 'all' || booking.apartmentId === parseInt(filterApartment);

                // For viewers, only show upcoming bookings (check-out date is in the future)
                const now = new Date();
                const checkOutDate = new Date(booking.checkOut);
                const isUpcoming = checkOutDate >= now;

                if (!isAdmin && !isUpcoming) {
                    return false;
                }

                return matchesSearch && matchesStatus && matchesApartment;
            });

            if (!currentUser) {
                return (
                    <div className="login-wrapper">
                        <div className="login-card">
                            <div className="login-header">
                                <div className="login-icon">
                                    <Home />
                                </div>
                                <h1 className="login-title">Premier Heights</h1>
                                <p className="login-subtitle">Booking Manager - Sign in to continue</p>
                            </div>
                            
                            <form onSubmit={handleLogin}>
                                <div className="form-group">
                                    <label className="form-label">Username</label>
                                    <input
                                        type="text"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                                        className="form-input"
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Password</label>
                                    <input
                                        type="password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                                        className="form-input"
                                        required
                                    />
                                </div>
                                
                                <button type="submit" className="btn btn-primary">
                                    Sign In
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="app-wrapper">
                    <div className="header">
                        <div className="header-content">
                            <div className="header-left">
                                <div className="header-icon">
                                    <Home />
                                </div>
                                <div>
                                    <h1 className="header-title">Premier Heights</h1>
                                    <p className="header-subtitle">Welcome, {currentUser.name} ({currentUser.role})</p>
                                </div>
                            </div>
                            <button onClick={handleLogout} className="logout-btn">
                                <LogOut />
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>

                    <div className="nav">
                        <div className="nav-content">
                            <button
                                onClick={() => setActiveTab('dashboard')}
                                className={`nav-btn ${activeTab === 'dashboard' ? 'active' : ''}`}
                            >
                                Dashboard
                            </button>
                            <button
                                onClick={() => setActiveTab('bookings')}
                                className={`nav-btn ${activeTab === 'bookings' ? 'active' : ''}`}
                            >
                                All Bookings
                            </button>
                            <button
                                onClick={() => setActiveTab('calendar')}
                                className={`nav-btn ${activeTab === 'calendar' ? 'active' : ''}`}
                            >
                                Calendar
                            </button>
                            {isAdmin && (
                                <>
                                    <button
                                        onClick={() => setActiveTab('reports')}
                                        className={`nav-btn ${activeTab === 'reports' ? 'active' : ''}`}
                                    >
                                        Reports
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('expenses')}
                                        className={`nav-btn ${activeTab === 'expenses' ? 'active' : ''}`}
                                    >
                                        Expenses
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('apartments')}
                                        className={`nav-btn ${activeTab === 'apartments' ? 'active' : ''}`}
                                    >
                                        Apartments
                                    </button>
                                </>
                            )}
                        </div>
                    </div>

                    <div className="main-content">
                        {activeTab === 'dashboard' && (
                            <div>
                                <div className="section-header">
                                    <h2 className="section-title">Dashboard Overview</h2>
                                    {isAdmin && (
                                        <button
                                            onClick={() => {
                                                setShowBookingForm(true);
                                                setEditingBooking(null);
                                                setBookingForm({
                                                    apartmentId: '',
                                                    bookingType: 'agent',
                                                    guestName: '',
                                                    agentName: '',
                                                    contact: '',
                                                    idNumber: '',
                                                    checkIn: '',
                                                    checkOut: '',
                                                    discountPerDay: 0,
                                                    paymentConfirmation: '',
                                                    amountPaid: '',
                                                    totalAmount: '',
                                                    status: 'pending',
                                                    notes: ''
                                                });
                                                setActiveTab('bookings');
                                            }}
                                            className="btn btn-primary"
                                        >
                                            <Plus />
                                            <span>New Booking</span>
                                        </button>
                                    )}
                                </div>

                                <div className="stats-grid">
                                    <div className="stat-card" onClick={isAdmin ? () => {
                                        setSelectedApartmentId(null);
                                        setShowApartmentsModal(true);
                                    } : undefined} style={{ cursor: isAdmin ? 'pointer' : 'default' }}>
                                        <div className="stat-content">
                                            <div>
                                                <p className="stat-label">Total Apartments</p>
                                                <p className="stat-value">{apartments.length}</p>
                                            </div>
                                            <div className="stat-icon stat-icon-indigo">
                                                <Home />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="stat-card" onClick={isAdmin ? () => setShowActiveBookingsModal(true) : undefined} style={{ cursor: isAdmin ? 'pointer' : 'default' }}>
                                        <div className="stat-content">
                                            <div>
                                                <p className="stat-label">Active Bookings</p>
                                                <p className="stat-value">
                                                    {bookings.filter(b => b.status === 'confirmed' || b.status === 'checked-in').length}
                                                </p>
                                            </div>
                                            <div className="stat-icon stat-icon-green">
                                                <Calendar />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="stat-card">
                                        <div className="stat-content">
                                            <div>
                                                <p className="stat-label">Pending Bookings</p>
                                                <p className="stat-value">
                                                    {bookings.filter(b => b.status === 'pending').length}
                                                </p>
                                            </div>
                                            <div className="stat-icon stat-icon-yellow">
                                                <Users />
                                            </div>
                                        </div>
                                    </div>

                                    {isAdmin && (
                                        <div className="stat-card" onClick={() => setShowRevenueModal(true)}>
                                            <div className="stat-content">
                                                <div>
                                                    <p className="stat-label">Total Revenue</p>
                                                    <p className="stat-value">
                                                        ‚Ç¶{bookings.reduce((sum, b) => sum + (b.amountPaid || 0), 0).toLocaleString()}
                                                    </p>
                                                </div>
                                                <div className="stat-icon stat-icon-blue">
                                                    <DollarSign />
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Today's Activity Section */}
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem', marginBottom: '1.5rem' }}>
                                    {/* Check-ins Today */}
                                    <div className="stat-card" style={{ background: 'linear-gradient(135deg, #2E3192 0%, #F15A29 100%)', color: 'white' }}>
                                        <h3 style={{ fontSize: '1.125rem', fontWeight: '600', marginBottom: '1rem' }}>
                                            Check-ins Today
                                        </h3>
                                        {(() => {
                                            const today = new Date().toDateString();
                                            const todayCheckins = bookings.filter(b => {
                                                const checkIn = new Date(b.checkIn).toDateString();
                                                return checkIn === today && b.status !== 'cancelled';
                                            });
                                            
                                            return todayCheckins.length > 0 ? (
                                                <div>
                                                    <div style={{ fontSize: '2.5rem', fontWeight: '700', marginBottom: '0.5rem' }}>
                                                        {todayCheckins.length}
                                                    </div>
                                                    {todayCheckins.map(booking => {
                                                        const apartment = apartments.find(a => a.id === booking.apartmentId);
                                                        return (
                                                            <div key={booking.id} style={{ 
                                                                background: 'rgba(255,255,255,0.2)', 
                                                                padding: '0.5rem', 
                                                                borderRadius: '0.25rem',
                                                                marginBottom: '0.5rem',
                                                                fontSize: '0.875rem'
                                                            }}>
                                                                <div style={{ fontWeight: '600' }}>{booking.guestName}</div>
                                                                <div style={{ opacity: 0.9 }}>{apartment?.name} Apartment</div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            ) : (
                                                <div style={{ fontSize: '1rem', opacity: 0.9 }}>No check-ins scheduled for today</div>
                                            );
                                        })()}
                                    </div>

                                    {/* Check-outs Today */}
                                    <div className="stat-card" style={{ background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', color: 'white' }}>
                                        <h3 style={{ fontSize: '1.125rem', fontWeight: '600', marginBottom: '1rem' }}>
                                            Check-outs Today
                                        </h3>
                                        {(() => {
                                            const today = new Date().toDateString();
                                            const todayCheckouts = bookings.filter(b => {
                                                const checkOut = new Date(b.checkOut).toDateString();
                                                return checkOut === today && b.status !== 'cancelled';
                                            });
                                            
                                            return todayCheckouts.length > 0 ? (
                                                <div>
                                                    <div style={{ fontSize: '2.5rem', fontWeight: '700', marginBottom: '0.5rem' }}>
                                                        {todayCheckouts.length}
                                                    </div>
                                                    {todayCheckouts.map(booking => {
                                                        const apartment = apartments.find(a => a.id === booking.apartmentId);
                                                        return (
                                                            <div key={booking.id} style={{ 
                                                                background: 'rgba(255,255,255,0.2)', 
                                                                padding: '0.5rem', 
                                                                borderRadius: '0.25rem',
                                                                marginBottom: '0.5rem',
                                                                fontSize: '0.875rem'
                                                            }}>
                                                                <div style={{ fontWeight: '600' }}>{booking.guestName}</div>
                                                                <div style={{ opacity: 0.9 }}>{apartment?.name} Apartment</div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            ) : (
                                                <div style={{ fontSize: '1rem', opacity: 0.9 }}>No check-outs scheduled for today</div>
                                            );
                                        })()}
                                    </div>
                                </div>

                                <div className="apartments-grid">
                                    {apartments.map(apartment => {
                                        const upcomingBookings = getApartmentBookings(apartment.id);
                                        const nextBooking = upcomingBookings.sort((a, b) => 
                                            new Date(a.checkIn) - new Date(b.checkIn)
                                        )[0];

                                        return (
                                            <div 
                                                key={apartment.id} 
                                                className="apartment-card"
                                                onClick={isAdmin ? () => {
                                                    setSelectedApartmentId(apartment.id);
                                                    setShowApartmentsModal(true);
                                                } : undefined}
                                                style={{ cursor: isAdmin ? 'pointer' : 'default' }}
                                            >
                                                <div className="apartment-header">
                                                    <div>
                                                        <h3 className="apartment-name">{apartment.name}</h3>
                                                        <p className="apartment-bedrooms">{apartment.bedrooms} Bedrooms</p>
                                                    </div>
                                                    <div className="apartment-icon">
                                                        <Home />
                                                    </div>
                                                </div>

                                                {isAdmin && (
                                                    <div className="apartment-price">
                                                        <p className="price-label">Price per Night</p>
                                                        <p className="price-value">‚Ç¶{apartment.pricePerNight.toLocaleString()}</p>
                                                    </div>
                                                )}

                                                {nextBooking ? (
                                                    <div className="booking-info booking-info-blue">
                                                        <p className="booking-info-label">Next Booking</p>
                                                        <p className="booking-info-guest">{nextBooking.guestName}</p>
                                                        <p className="booking-info-dates">
                                                            {new Date(nextBooking.checkIn).toLocaleDateString()} - {new Date(nextBooking.checkOut).toLocaleDateString()}
                                                        </p>
                                                        <span className={`status-badge status-${nextBooking.status}`} style={{ marginTop: '0.5rem' }}>
                                                            {nextBooking.status}
                                                        </span>
                                                    </div>
                                                ) : (
                                                    <div className="booking-info booking-info-green">
                                                        <p className="available-text">Available</p>
                                                        <p className="available-subtext">No upcoming bookings</p>
                                                    </div>
                                                )}

                                                {upcomingBookings.length > 1 && (
                                                    <p className="more-bookings">
                                                        +{upcomingBookings.length - 1} more booking{upcomingBookings.length > 2 ? 's' : ''}
                                                    </p>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Apartments Modal - Admin Only */}
                                {showApartmentsModal && isAdmin && (
                                    <div className="modal-overlay" onClick={() => {
                                        setShowApartmentsModal(false);
                                        setSelectedApartmentId(null);
                                    }}>
                                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                            <div className="modal-header">
                                                <h2 className="modal-title">
                                                    {selectedApartmentId 
                                                        ? `${apartments.find(a => a.id === selectedApartmentId)?.name} Apartment Analytics`
                                                        : 'All Apartments Analytics'
                                                    }
                                                </h2>
                                                <button className="modal-close" onClick={() => {
                                                    setShowApartmentsModal(false);
                                                    setSelectedApartmentId(null);
                                                }}>√ó</button>
                                            </div>
                                            <div className="modal-body">
                                                {apartments
                                                    .filter(apartment => !selectedApartmentId || apartment.id === selectedApartmentId)
                                                    .map(apartment => {
                                                    const aptBookings = bookings.filter(b => b.apartmentId === apartment.id && b.status !== 'cancelled');
                                                    const thisMonthBookings = aptBookings.filter(b => {
                                                        const checkIn = new Date(b.checkIn);
                                                        const now = new Date();
                                                        return checkIn.getMonth() === now.getMonth() && checkIn.getFullYear() === now.getFullYear();
                                                    });
                                                    const monthRevenue = thisMonthBookings.reduce((sum, b) => sum + (b.amountPaid || 0), 0);
                                                    const upcomingBookings = aptBookings.filter(b => new Date(b.checkIn) > new Date()).sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn));

                                                    return (
                                                        <div key={apartment.id} className="apartment-detail-card">
                                                            <h3 style={{ fontSize: '1.5rem', fontWeight: '700', marginBottom: '1rem', color: '#1f2937' }}>
                                                                {apartment.name} Apartment
                                                            </h3>
                                                            
                                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '1rem', marginBottom: '1rem' }}>
                                                                <div style={{ background: 'white', padding: '1rem', borderRadius: '0.5rem' }}>
                                                                    <div style={{ fontSize: '0.75rem', color: '#6b7280', marginBottom: '0.25rem' }}>Total Bookings</div>
                                                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#2E3192' }}>{aptBookings.length}</div>
                                                                </div>
                                                                <div style={{ background: 'white', padding: '1rem', borderRadius: '0.5rem' }}>
                                                                    <div style={{ fontSize: '0.75rem', color: '#6b7280', marginBottom: '0.25rem' }}>This Month Revenue</div>
                                                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#10b981' }}>‚Ç¶{monthRevenue.toLocaleString()}</div>
                                                                </div>
                                                                <div style={{ background: 'white', padding: '1rem', borderRadius: '0.5rem' }}>
                                                                    <div style={{ fontSize: '0.75rem', color: '#6b7280', marginBottom: '0.25rem' }}>Price/Night</div>
                                                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#f59e0b' }}>‚Ç¶{apartment.pricePerNight.toLocaleString()}</div>
                                                                </div>
                                                            </div>

                                                            <div className="modal-section">
                                                                <h4 style={{ fontSize: '1rem', fontWeight: '600', marginBottom: '0.75rem', color: '#1f2937' }}>
                                                                    Upcoming Check-ins ({upcomingBookings.length})
                                                                </h4>
                                                                {upcomingBookings.length > 0 ? (
                                                                    upcomingBookings.slice(0, 5).map(booking => (
                                                                        <div key={booking.id} style={{ 
                                                                            background: 'white', 
                                                                            padding: '0.75rem', 
                                                                            borderRadius: '0.5rem', 
                                                                            marginBottom: '0.5rem',
                                                                            display: 'flex',
                                                                            justifyContent: 'space-between',
                                                                            alignItems: 'center'
                                                                        }}>
                                                                            <div>
                                                                                <div style={{ fontWeight: '600' }}>{booking.guestName}</div>
                                                                                <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                                                                    {new Date(booking.checkIn).toLocaleDateString()} - {new Date(booking.checkOut).toLocaleDateString()}
                                                                                </div>
                                                                            </div>
                                                                            <span className={`status-badge status-${booking.status}`}>{booking.status}</span>
                                                                        </div>
                                                                    ))
                                                                ) : (
                                                                    <p style={{ color: '#6b7280', fontSize: '0.875rem' }}>No upcoming bookings</p>
                                                                )}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Active Bookings Modal - Admin Only */}
                                {showActiveBookingsModal && isAdmin && (
                                    <div className="modal-overlay" onClick={() => setShowActiveBookingsModal(false)}>
                                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                            <div className="modal-header">
                                                <h2 className="modal-title">Upcoming Bookings (Next 30 Days)</h2>
                                                <button className="modal-close" onClick={() => setShowActiveBookingsModal(false)}>√ó</button>
                                            </div>
                                            <div className="modal-body">
                                                {(() => {
                                                    const now = new Date();
                                                    const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
                                                    const upcomingBookings = bookings
                                                        .filter(b => {
                                                            const checkIn = new Date(b.checkIn);
                                                            return checkIn >= now && checkIn <= thirtyDaysFromNow && b.status !== 'cancelled';
                                                        })
                                                        .sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn));

                                                    return upcomingBookings.length > 0 ? (
                                                        upcomingBookings.map(booking => {
                                                            const apartment = apartments.find(a => a.id === booking.apartmentId);
                                                            const nights = Math.ceil((new Date(booking.checkOut) - new Date(booking.checkIn)) / (1000 * 60 * 60 * 24));
                                                            
                                                            return (
                                                                <div key={booking.id} className="booking-list-item">
                                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>
                                                                        <div>
                                                                            <h4 style={{ fontSize: '1.125rem', fontWeight: '600', color: '#1f2937' }}>{booking.guestName}</h4>
                                                                            <p style={{ fontSize: '0.875rem', color: '#6b7280' }}>{apartment?.name} Apartment</p>
                                                                        </div>
                                                                        <span className={`status-badge status-${booking.status}`}>{booking.status}</span>
                                                                    </div>
                                                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '1rem', fontSize: '0.875rem' }}>
                                                                        <div>
                                                                            <span style={{ color: '#6b7280' }}>Check-in:</span>
                                                                            <div style={{ fontWeight: '600' }}>{new Date(booking.checkIn).toLocaleDateString()}</div>
                                                                        </div>
                                                                        <div>
                                                                            <span style={{ color: '#6b7280' }}>Check-out:</span>
                                                                            <div style={{ fontWeight: '600' }}>{new Date(booking.checkOut).toLocaleDateString()}</div>
                                                                        </div>
                                                                        <div>
                                                                            <span style={{ color: '#6b7280' }}>Duration:</span>
                                                                            <div style={{ fontWeight: '600' }}>{nights} night{nights > 1 ? 's' : ''}</div>
                                                                        </div>
                                                                    </div>
                                                                    {isAdmin && (
                                                                        <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', color: '#6b7280' }}>
                                                                            Total: ‚Ç¶{booking.totalAmount?.toLocaleString()} | Paid: ‚Ç¶{booking.amountPaid?.toLocaleString()} | Balance: ‚Ç¶{(booking.totalAmount - booking.amountPaid)?.toLocaleString()}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            );
                                                        })
                                                    ) : (
                                                        <p style={{ textAlign: 'center', color: '#6b7280', padding: '2rem' }}>No bookings in the next 30 days</p>
                                                    );
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Revenue Modal */}
                                {showRevenueModal && isAdmin && (
                                    <div className="modal-overlay" onClick={() => setShowRevenueModal(false)}>
                                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                            <div className="modal-header">
                                                <h2 className="modal-title">Revenue Statement</h2>
                                                <button className="modal-close" onClick={() => setShowRevenueModal(false)}>√ó</button>
                                            </div>
                                            <div className="modal-body">
                                                {(() => {
                                                    const totalRevenue = bookings.filter(b => b.status !== 'cancelled').reduce((sum, b) => sum + (b.amountPaid || 0), 0);
                                                    const totalExpected = bookings.filter(b => b.status !== 'cancelled').reduce((sum, b) => sum + (b.totalAmount || 0), 0);
                                                    const outstanding = totalExpected - totalRevenue;
                                                    
                                                    // Monthly breakdown
                                                    const monthlyData = {};
                                                    bookings.filter(b => b.status !== 'cancelled').forEach(b => {
                                                        const date = new Date(b.checkIn);
                                                        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                                                        if (!monthlyData[monthKey]) {
                                                            monthlyData[monthKey] = { revenue: 0, bookings: 0 };
                                                        }
                                                        monthlyData[monthKey].revenue += b.amountPaid || 0;
                                                        monthlyData[monthKey].bookings += 1;
                                                    });

                                                    return (
                                                        <div>
                                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '1rem', marginBottom: '2rem' }}>
                                                                <div style={{ background: 'linear-gradient(135deg, #2E3192 0%, #F15A29 100%)', color: 'white', padding: '1.5rem', borderRadius: '0.75rem' }}>
                                                                    <div style={{ fontSize: '0.875rem', marginBottom: '0.5rem', opacity: 0.9 }}>Total Revenue</div>
                                                                    <div style={{ fontSize: '2rem', fontWeight: '700' }}>‚Ç¶{totalRevenue.toLocaleString()}</div>
                                                                </div>
                                                                <div style={{ background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', color: 'white', padding: '1.5rem', borderRadius: '0.75rem' }}>
                                                                    <div style={{ fontSize: '0.875rem', marginBottom: '0.5rem', opacity: 0.9 }}>Outstanding</div>
                                                                    <div style={{ fontSize: '2rem', fontWeight: '700' }}>‚Ç¶{outstanding.toLocaleString()}</div>
                                                                </div>
                                                                <div style={{ background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', color: 'white', padding: '1.5rem', borderRadius: '0.75rem' }}>
                                                                    <div style={{ fontSize: '0.875rem', marginBottom: '0.5rem', opacity: 0.9 }}>Expected Total</div>
                                                                    <div style={{ fontSize: '2rem', fontWeight: '700' }}>‚Ç¶{totalExpected.toLocaleString()}</div>
                                                                </div>
                                                            </div>

                                                            <div className="modal-section">
                                                                <h4 className="modal-section-title">Monthly Revenue Breakdown</h4>
                                                                {Object.entries(monthlyData)
                                                                    .sort((a, b) => b[0].localeCompare(a[0]))
                                                                    .slice(0, 6)
                                                                    .map(([month, data]) => {
                                                                        const date = new Date(month + '-01');
                                                                        const monthName = date.toLocaleDateString('en', { month: 'long', year: 'numeric' });
                                                                        
                                                                        return (
                                                                            <div key={month} style={{ 
                                                                                display: 'flex', 
                                                                                justifyContent: 'space-between',
                                                                                padding: '1rem',
                                                                                background: '#f9fafb',
                                                                                borderRadius: '0.5rem',
                                                                                marginBottom: '0.75rem'
                                                                            }}>
                                                                                <div>
                                                                                    <div style={{ fontWeight: '600', fontSize: '1rem' }}>{monthName}</div>
                                                                                    <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>{data.bookings} booking{data.bookings > 1 ? 's' : ''}</div>
                                                                                </div>
                                                                                <div style={{ fontSize: '1.25rem', fontWeight: '700', color: '#2E3192' }}>
                                                                                    ‚Ç¶{data.revenue.toLocaleString()}
                                                                                </div>
                                                                            </div>
                                                                        );
                                                                    })
                                                                }
                                                            </div>
                                                        </div>
                                                    );
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'bookings' && (
                            <div>
                                <div className="section-header">
                                    <h2 className="section-title">All Bookings</h2>
                                    {isAdmin && !showBookingForm && (
                                        <button
                                            onClick={() => {
                                                setShowBookingForm(true);
                                                setEditingBooking(null);
                                                setBookingForm({
                                                    apartmentId: '',
                                                    bookingType: 'agent',
                                                    guestName: '',
                                                    agentName: '',
                                                    contact: '',
                                                    idNumber: '',
                                                    checkIn: '',
                                                    checkOut: '',
                                                    discountPerDay: 0,
                                                    paymentConfirmation: '',
                                                    amountPaid: '',
                                                    totalAmount: '',
                                                    status: 'pending',
                                                    notes: ''
                                                });
                                            }}
                                            className="btn btn-primary"
                                        >
                                            <Plus />
                                            <span>New Booking</span>
                                        </button>
                                    )}
                                </div>

                                {showBookingForm && isAdmin && (
                                    <div className="form-card">
                                        <h3 className="form-title">
                                            {editingBooking ? 'Edit Booking' : 'New Booking'}
                                        </h3>
                                        
                                        <form onSubmit={handleBookingSubmit}>
                                            <div className="form-grid">
                                                <div className="form-group">
                                                    <label className="form-label">Apartment *</label>
                                                    <select
                                                        value={bookingForm.apartmentId}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, apartmentId: e.target.value })}
                                                        required
                                                    >
                                                        <option value="">Select apartment</option>
                                                        {apartments.length === 0 ? (
                                                            <option value="" disabled>Loading apartments...</option>
                                                        ) : (
                                                            apartments.map(apt => (
                                                                <option key={apt.id} value={apt.id}>
                                                                    {apt.name}
                                                                </option>
                                                            ))
                                                        )}
                                                    </select>
                                                    {apartments.length === 0 && (
                                                        <p style={{ fontSize: '0.75rem', color: '#dc2626', marginTop: '0.25rem' }}>
                                                            If apartments don't load, check your Firebase connection
                                                        </p>
                                                    )}
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Booking Type *</label>
                                                    <select
                                                        value={bookingForm.bookingType}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, bookingType: e.target.value })}
                                                        required
                                                    >
                                                        <option value="agent">Agent Booking - ‚Ç¶180,000/night</option>
                                                        <option value="direct">Direct Booking - ‚Ç¶200,000/night</option>
                                                    </select>
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Guest Name *</label>
                                                    <input
                                                        type="text"
                                                        value={bookingForm.guestName}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, guestName: e.target.value })}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>

                                                {bookingForm.bookingType === 'agent' && (
                                                    <div className="form-group">
                                                        <label className="form-label">Agent Name *</label>
                                                        <input
                                                            type="text"
                                                            value={bookingForm.agentName}
                                                            onChange={(e) => setBookingForm({ ...bookingForm, agentName: e.target.value })}
                                                            className="form-input"
                                                            required
                                                        />
                                                    </div>
                                                )}

                                                <div className="form-group">
                                                    <label className="form-label">Contact *</label>
                                                    <input
                                                        type="text"
                                                        value={bookingForm.contact}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, contact: e.target.value })}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">ID Number *</label>
                                                    <input
                                                        type="text"
                                                        value={bookingForm.idNumber}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, idNumber: e.target.value })}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Payment Confirmation</label>
                                                    <input
                                                        type="text"
                                                        value={bookingForm.paymentConfirmation}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, paymentConfirmation: e.target.value })}
                                                        className="form-input"
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Check-In Date *</label>
                                                    <input
                                                        type="date"
                                                        value={bookingForm.checkIn}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, checkIn: e.target.value })}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Check-Out Date *</label>
                                                    <input
                                                        type="date"
                                                        value={bookingForm.checkOut}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, checkOut: e.target.value })}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Discount Per Day (Optional)</label>
                                                    <input
                                                        type="number"
                                                        step="1000"
                                                        min="0"
                                                        value={bookingForm.discountPerDay}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, discountPerDay: e.target.value })}
                                                        className="form-input"
                                                        placeholder="0"
                                                    />
                                                    <p style={{ fontSize: '0.75rem', color: '#6b7280', marginTop: '0.25rem' }}>
                                                        For long-term bookings. Reduces price per night by this amount.
                                                    </p>
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Booking Status *</label>
                                                    <select
                                                        value={bookingForm.status}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, status: e.target.value })}
                                                        required
                                                    >
                                                        <option value="pending">Pending</option>
                                                        <option value="confirmed">Confirmed</option>
                                                        <option value="checked-in">Checked In</option>
                                                        <option value="completed">Completed</option>
                                                        <option value="cancelled">Cancelled</option>
                                                    </select>
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Amount Paid</label>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={bookingForm.amountPaid}
                                                        onChange={(e) => setBookingForm({ ...bookingForm, amountPaid: e.target.value })}
                                                        className="form-input"
                                                    />
                                                </div>
                                            </div>

                                            {bookingForm.checkIn && bookingForm.checkOut && bookingForm.apartmentId && (
                                                <div className="calculation-box">
                                                    <div className="calculation-grid">
                                                        <div>
                                                            <p>Number of Nights</p>
                                                            <p className="calculation-value calc-gray">
                                                                {calculateNights(bookingForm.checkIn, bookingForm.checkOut)}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <p>Total Amount</p>
                                                            <p className="calculation-value calc-indigo">
                                                                ‚Ç¶{calculateTotalAmount().toLocaleString()}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <p>Balance Due</p>
                                                            <p className="calculation-value calc-red">
                                                                ‚Ç¶{(calculateTotalAmount() - (parseFloat(bookingForm.amountPaid) || 0)).toLocaleString()}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            <div className="form-section">
                                                <label className="form-label">Notes</label>
                                                <textarea
                                                    value={bookingForm.notes}
                                                    onChange={(e) => setBookingForm({ ...bookingForm, notes: e.target.value })}
                                                    rows="3"
                                                />
                                            </div>

                                            <div className="form-buttons">
                                                <button type="submit" className="btn btn-primary">
                                                    {editingBooking ? 'Update Booking' : 'Create Booking'}
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        setShowBookingForm(false);
                                                        setEditingBooking(null);
                                                    }}
                                                    className="btn btn-secondary"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                )}

                                {!showBookingForm && (
                                    <>
                                        <div className="filter-card">
                                            <div className="filter-grid">
                                                <div className="search-wrapper">
                                                    <div className="search-icon">
                                                        <Search />
                                                    </div>
                                                    <input
                                                        type="text"
                                                        placeholder="Search by guest, contact, or agent..."
                                                        value={searchTerm}
                                                        onChange={(e) => setSearchTerm(e.target.value)}
                                                        className="search-input"
                                                    />
                                                </div>

                                                <div>
                                                    <select
                                                        value={filterStatus}
                                                        onChange={(e) => setFilterStatus(e.target.value)}
                                                    >
                                                        <option value="all">All Statuses</option>
                                                        <option value="pending">Pending</option>
                                                        <option value="confirmed">Confirmed</option>
                                                        <option value="checked-in">Checked In</option>
                                                        <option value="completed">Completed</option>
                                                        <option value="cancelled">Cancelled</option>
                                                    </select>
                                                </div>

                                                <div>
                                                    <select
                                                        value={filterApartment}
                                                        onChange={(e) => setFilterApartment(e.target.value)}
                                                    >
                                                        <option value="all">All Apartments</option>
                                                        {apartments.map(apt => (
                                                            <option key={apt.id} value={apt.id}>{apt.name}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bookings-list">
                                            {filteredBookings.length === 0 ? (
                                                <div className="empty-state">
                                                    <div className="empty-icon">
                                                        <Calendar />
                                                    </div>
                                                    <p className="empty-text">No bookings found</p>
                                                </div>
                                            ) : (
                                                filteredBookings.sort((a, b) => new Date(b.checkIn) - new Date(a.checkIn)).map(booking => {
                                                    const apartment = apartments.find(a => a.id === booking.apartmentId);
                                                    const balance = booking.totalAmount - booking.amountPaid;

                                                    return (
                                                        <div key={booking.id} className="booking-card">
                                                            <div className="booking-header">
                                                                <div className="booking-header-left">
                                                                    <div className="booking-name-row">
                                                                        <h3 className="booking-name">{booking.guestName}</h3>
                                                                        <span className={`status-badge status-${booking.status}`}>
                                                                            {booking.status}
                                                                        </span>
                                                                    </div>
                                                                    <p className="booking-apartment">{apartment?.name}</p>
                                                                </div>

                                                                {isAdmin && (
                                                                    <div className="booking-actions">
                                                                        <button
                                                                            onClick={() => handleDuplicateBooking(booking)}
                                                                            className="btn btn-secondary"
                                                                            title="Duplicate booking"
                                                                            style={{ padding: '0.5rem', fontSize: '0.875rem' }}
                                                                        >
                                                                            üìã Copy
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleEditBooking(booking)}
                                                                            className="btn btn-edit"
                                                                        >
                                                                            <Edit2 />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleDeleteBooking(booking.id)}
                                                                            className="btn btn-danger"
                                                                        >
                                                                            <Trash2 />
                                                                        </button>
                                                                    </div>
                                                                )}
                                                            </div>

                                                            {/* Quick Status Update Buttons (Admin Only) */}
                                                            {isAdmin && booking.status !== 'completed' && booking.status !== 'cancelled' && (
                                                                <div style={{ 
                                                                    display: 'flex', 
                                                                    gap: '0.5rem', 
                                                                    marginBottom: '1rem',
                                                                    flexWrap: 'wrap'
                                                                }}>
                                                                    {booking.status === 'pending' && (
                                                                        <button
                                                                            onClick={() => handleQuickStatusUpdate(booking.id, 'confirmed')}
                                                                            style={{
                                                                                padding: '0.5rem 1rem',
                                                                                background: '#3b82f6',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '0.5rem',
                                                                                cursor: 'pointer',
                                                                                fontSize: '0.875rem',
                                                                                fontWeight: '500'
                                                                            }}
                                                                        >
                                                                            ‚úÖ Confirm Booking
                                                                        </button>
                                                                    )}
                                                                    {booking.status === 'confirmed' && (
                                                                        <button
                                                                            onClick={() => handleQuickStatusUpdate(booking.id, 'checked-in')}
                                                                            style={{
                                                                                padding: '0.5rem 1rem',
                                                                                background: '#10b981',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '0.5rem',
                                                                                cursor: 'pointer',
                                                                                fontSize: '0.875rem',
                                                                                fontWeight: '500'
                                                                            }}
                                                                        >
                                                                            üè† Check In
                                                                        </button>
                                                                    )}
                                                                    {booking.status === 'checked-in' && (
                                                                        <button
                                                                            onClick={() => handleQuickStatusUpdate(booking.id, 'completed')}
                                                                            style={{
                                                                                padding: '0.5rem 1rem',
                                                                                background: '#6b7280',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '0.5rem',
                                                                                cursor: 'pointer',
                                                                                fontSize: '0.875rem',
                                                                                fontWeight: '500'
                                                                            }}
                                                                        >
                                                                            ‚úì Complete
                                                                        </button>
                                                                    )}
                                                                    {booking.status !== 'cancelled' && (
                                                                        <button
                                                                            onClick={() => {
                                                                                if (window.confirm('Are you sure you want to cancel this booking?')) {
                                                                                    handleQuickStatusUpdate(booking.id, 'cancelled');
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                padding: '0.5rem 1rem',
                                                                                background: '#ef4444',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '0.5rem',
                                                                                cursor: 'pointer',
                                                                                fontSize: '0.875rem',
                                                                                fontWeight: '500'
                                                                            }}
                                                                        >
                                                                            ‚ùå Cancel
                                                                        </button>
                                                                    )}
                                                                </div>
                                                            )}

                                                            {/* WhatsApp Send Button - Show for confirmed/checked-in bookings (Admin Only) */}
                                                            {isAdmin && (booking.status === 'confirmed' || booking.status === 'checked-in') && booking.contact && (
                                                                <div style={{ marginBottom: '1rem' }}>
                                                                    <button
                                                                        onClick={() => sendWhatsAppMessage(booking)}
                                                                        className="btn-whatsapp"
                                                                        title="Send check-in details via WhatsApp"
                                                                    >
                                                                        <MessageCircle />
                                                                        <span>Send Check-in Details</span>
                                                                    </button>
                                                                    <p style={{ 
                                                                        fontSize: '0.75rem', 
                                                                        color: '#6b7280', 
                                                                        marginTop: '0.25rem',
                                                                        fontStyle: 'italic'
                                                                    }}>
                                                                        Will send to: {booking.contact}
                                                                    </p>
                                                                </div>
                                                            )}

                                                            <div className="booking-details-grid">
                                                                <div className="detail-item">
                                                                    <p className="detail-label">Booking Type</p>
                                                                    <p className="detail-value" style={{ 
                                                                        textTransform: 'capitalize',
                                                                        fontWeight: '600',
                                                                        color: booking.bookingType === 'direct' ? '#10b981' : '#2E3192'
                                                                    }}>
                                                                        {booking.bookingType === 'direct' ? 'üè† Direct' : 'üë§ Agent'} 
                                                                        {isAdmin && (() => {
                                                                            const baseRate = booking.bookingType === 'direct' ? 200000 : 180000;
                                                                            const discount = booking.discountPerDay || 0;
                                                                            const effectiveRate = baseRate - discount;
                                                                            
                                                                            if (discount > 0) {
                                                                                return ` - ‚Ç¶${effectiveRate.toLocaleString()}/night (‚Ç¶${discount.toLocaleString()} discount)`;
                                                                            } else {
                                                                                return ` - ‚Ç¶${baseRate.toLocaleString()}/night`;
                                                                            }
                                                                        })()}
                                                                    </p>
                                                                </div>
                                                                {booking.agentName && (
                                                                    <div className="detail-item">
                                                                        <p className="detail-label">Agent</p>
                                                                        <p className="detail-value">{booking.agentName}</p>
                                                                    </div>
                                                                )}
                                                                <div className="detail-item">
                                                                    <p className="detail-label">Contact</p>
                                                                    <p className="detail-value">{booking.contact}</p>
                                                                </div>
                                                                <div className="detail-item">
                                                                    <p className="detail-label">ID Number</p>
                                                                    <p className="detail-value">{booking.idNumber}</p>
                                                                </div>
                                                                {isAdmin && (
                                                                    <div className="detail-item">
                                                                        <p className="detail-label">Payment Confirmation</p>
                                                                        <p className="detail-value">{booking.paymentConfirmation || 'N/A'}</p>
                                                                    </div>
                                                                )}
                                                            </div>

                                                            {isAdmin ? (
                                                                <div className="payment-grid">
                                                                    <div>
                                                                        <p className="detail-label">Check-In</p>
                                                                        <p className="detail-value">{new Date(booking.checkIn).toLocaleDateString()}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="detail-label">Check-Out</p>
                                                                        <p className="detail-value">{new Date(booking.checkOut).toLocaleDateString()}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="detail-label">Total Amount</p>
                                                                        <p className="detail-value payment-total">‚Ç¶{booking.totalAmount.toLocaleString()}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="detail-label">Amount Paid</p>
                                                                        <p className="detail-value payment-paid">‚Ç¶{booking.amountPaid.toLocaleString()}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="detail-label">Balance</p>
                                                                        <p className={`detail-value ${balance > 0 ? 'calc-red' : 'calc-green'}`}>
                                                                            ‚Ç¶{balance.toLocaleString()}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div className="payment-grid" style={{ gridTemplateColumns: 'repeat(2, 1fr)' }}>
                                                                    <div>
                                                                        <p className="detail-label">Check-In</p>
                                                                        <p className="detail-value">{new Date(booking.checkIn).toLocaleDateString()}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="detail-label">Check-Out</p>
                                                                        <p className="detail-value">{new Date(booking.checkOut).toLocaleDateString()}</p>
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {booking.notes && (
                                                                <div className="notes-box">
                                                                    <p className="notes-label">Notes</p>
                                                                    <p className="notes-text">{booking.notes}</p>
                                                                </div>
                                                            )}

                                                            {booking.createdBy && (
                                                                <p className="booking-meta">
                                                                    Created by {booking.createdBy} on {new Date(booking.createdAt).toLocaleString()}
                                                                </p>
                                                            )}
                                                        </div>
                                                    );
                                                })
                                            )}
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {activeTab === 'apartments' && (
                            <div>
                                <h2 className="section-title" style={{ marginBottom: '1.5rem' }}>Manage Apartments</h2>

                                <div className="manage-grid">
                                    {apartments.map(apartment => {
                                        const totalBookings = bookings.filter(b => b.apartmentId === apartment.id).length;
                                        const activeBookings = bookings.filter(b => 
                                            b.apartmentId === apartment.id && 
                                            (b.status === 'confirmed' || b.status === 'checked-in')
                                        ).length;
                                        const revenue = bookings
                                            .filter(b => b.apartmentId === apartment.id)
                                            .reduce((sum, b) => sum + b.amountPaid, 0);

                                        return (
                                            <div key={apartment.id} className="manage-card">
                                                <div className="manage-header">
                                                    <div>
                                                        <h3 className="manage-title">{apartment.name}</h3>
                                                        <p className="manage-subtitle">{apartment.bedrooms} Bedrooms</p>
                                                    </div>
                                                    <div className="manage-icon">
                                                        <Home />
                                                    </div>
                                                </div>

                                                <div className="price-input-group">
                                                    <label className="form-label">Price per Night</label>
                                                    <div className="price-input-wrapper">
                                                        <span className="dollar-sign">‚Ç¶</span>
                                                        <input
                                                            type="number"
                                                            step="0.01"
                                                            value={apartment.pricePerNight}
                                                            onChange={(e) => updateApartmentPrice(apartment.id, e.target.value)}
                                                            disabled={!isAdmin}
                                                            className="form-input"
                                                            style={{ flex: 1 }}
                                                        />
                                                    </div>
                                                    {!isAdmin && (
                                                        <p className="price-help">Only admins can update prices</p>
                                                    )}
                                                </div>

                                                <div className="stats-row">
                                                    <div className="stats-item">
                                                        <p>Total Bookings</p>
                                                        <p className="stats-gray">{totalBookings}</p>
                                                    </div>
                                                    <div className="stats-item">
                                                        <p>Active</p>
                                                        <p className="stats-green">{activeBookings}</p>
                                                    </div>
                                                    <div className="stats-item">
                                                        <p>Revenue</p>
                                                        <p className="stats-indigo">‚Ç¶{revenue.toLocaleString()}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Calendar Tab */}
                        {activeTab === 'calendar' && (
                            <div>
                                <div className="section-header">
                                    <h2 className="section-title">Booking Calendar</h2>
                                </div>

                                <div className="calendar-container">
                                    <div className="calendar-header">
                                        <h3 className="calendar-month">
                                            {calendarDate.toLocaleDateString('en', { month: 'long', year: 'numeric' })}
                                        </h3>
                                        <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', flexWrap: 'wrap' }}>
                                            <div className="calendar-nav">
                                                <button 
                                                    className="calendar-nav-btn"
                                                    onClick={() => {
                                                        const newDate = new Date(calendarDate);
                                                        newDate.setMonth(newDate.getMonth() - 1);
                                                        setCalendarDate(newDate);
                                                    }}
                                                >
                                                    ‚Üê Previous
                                                </button>
                                                <button 
                                                    className="calendar-nav-btn"
                                                    onClick={() => setCalendarDate(new Date())}
                                                >
                                                    Today
                                                </button>
                                                <button 
                                                    className="calendar-nav-btn"
                                                    onClick={() => {
                                                        const newDate = new Date(calendarDate);
                                                        newDate.setMonth(newDate.getMonth() + 1);
                                                        setCalendarDate(newDate);
                                                    }}
                                                >
                                                    Next ‚Üí
                                            </button>
                                        </div>
                                        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                                            <button
                                                className={`calendar-filter-btn ${apartmentFilter === 'all' ? 'active' : ''}`}
                                                onClick={() => setApartmentFilter('all')}
                                            >
                                                All
                                            </button>
                                            {apartments.map(apt => (
                                                <button
                                                    key={apt.id}
                                                    className={`calendar-filter-btn ${apartmentFilter === apt.id ? 'active' : ''}`}
                                                    onClick={() => setApartmentFilter(apt.id)}
                                                >
                                                    {apt.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    </div>

                                    <div className="calendar-grid">
                                        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                            <div key={day} className="calendar-day-header">{day}</div>
                                        ))}
                                        
                                        {getDaysInMonth(calendarDate).map((dayInfo, index) => {
                                            const dayBookings = getBookingsForDate(dayInfo.date, apartmentFilter);
                                            const isToday = dayInfo.date.toDateString() === new Date().toDateString();
                                            
                                            return (
                                                <div 
                                                    key={index}
                                                    className={`calendar-day ${!dayInfo.isCurrentMonth ? 'other-month' : ''} ${isToday ? 'today' : ''} ${dayInfo.isWeekend ? 'weekend' : ''}`}
                                                >
                                                    <div className="calendar-date">
                                                        <span>{dayInfo.date.getDate()}</span>
                                                        {dayBookings.length > 0 && (
                                                            <span className="booking-count-badge">{dayBookings.length}</span>
                                                        )}
                                                    </div>
                                                    {dayBookings.map(booking => {
                                                        const apartment = apartments.find(a => a.id === booking.apartmentId);
                                                        const color = getApartmentColor(booking.apartmentId);
                                                        // Show agent name for agent bookings, guest name for direct bookings
                                                        const displayName = booking.bookingType === 'agent' && booking.agentName 
                                                            ? booking.agentName 
                                                            : booking.guestName;
                                                        
                                                        return (
                                                            <div
                                                                key={booking.id}
                                                                className={`calendar-booking ${color} ${booking.status === 'pending' ? 'pending' : ''} ${booking.displayType || ''}`}
                                                                onClick={() => {
                                                                    setSelectedBooking(booking);
                                                                    setActiveTab('bookings');
                                                                }}
                                                                title={`${displayName} - ${apartment?.name} ${booking.displayType === 'checkout' ? '(Check-out AM)' : booking.displayType === 'checkin' ? '(Check-in PM)' : ''}`}
                                                            >
                                                                {displayName.split(' ')[0]}
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <div className="calendar-legend">
                                        <div className="legend-item">
                                            <div className="legend-color" style={{ background: '#00B000' }}></div>
                                            <span>Green Apartment</span>
                                        </div>
                                        <div className="legend-item">
                                            <div className="legend-color" style={{ background: '#F76B00' }}></div>
                                            <span>Orange Apartment</span>
                                        </div>
                                        <div className="legend-item">
                                            <div className="legend-color" style={{ background: '#0025F7' }}></div>
                                            <span>Blue Apartment</span>
                                        </div>
                                        <div className="legend-item">
                                            <div className="legend-color" style={{ background: '#F7EF00' }}></div>
                                            <span>Yellow Apartment</span>
                                        </div>
                                        <div className="legend-item">
                                            <span style={{ fontSize: '0.875rem', color: '#6b7280', marginLeft: '1rem' }}>
                                                ‚òÄÔ∏è = Check-out (AM) | üåô = Check-in (PM)
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Reports Tab (Admin Only) */}
                        {activeTab === 'reports' && isAdmin && (
                            <div>
                                <div className="section-header">
                                    <h2 className="section-title">Reports & Analytics</h2>
                                    <button onClick={exportToExcel} className="btn-export">
                                        üìä Export to Excel
                                    </button>
                                </div>

                                {/* Summary Cards */}
                                <div className="reports-grid">
                                    <div className="report-card">
                                        <div className="report-card-title">Total Revenue (All Time)</div>
                                        <div className="report-value">
                                            ‚Ç¶{bookings.filter(b => b.status !== 'cancelled').reduce((sum, b) => sum + (b.amountPaid || 0), 0).toLocaleString()}
                                        </div>
                                        <div className="report-subtitle">From {bookings.length} bookings</div>
                                    </div>

                                    <div className="report-card">
                                        <div className="report-card-title">Outstanding Payments</div>
                                        <div className="report-value" style={{ color: '#dc2626' }}>
                                            ‚Ç¶{bookings.filter(b => b.status !== 'cancelled' && b.status !== 'completed')
                                                .reduce((sum, b) => sum + (b.totalAmount - b.amountPaid), 0).toLocaleString()}
                                        </div>
                                        <div className="report-subtitle">
                                            {bookings.filter(b => (b.totalAmount - b.amountPaid) > 0 && b.status !== 'cancelled').length} bookings with balance
                                        </div>
                                    </div>

                                    <div className="report-card">
                                        <div className="report-card-title">Occupancy Rate (Last 30 Days)</div>
                                        <div className="report-value" style={{ color: '#059669' }}>
                                            {calculateOccupancyRate()}%
                                        </div>
                                        <div className="report-subtitle">Across {apartments.length} apartments</div>
                                    </div>

                                    <div className="report-card">
                                        <div className="report-card-title">Average Booking Value</div>
                                        <div className="report-value">
                                            ‚Ç¶{bookings.length > 0 
                                                ? (bookings.reduce((sum, b) => sum + (b.totalAmount || 0), 0) / bookings.length).toFixed(0).toLocaleString()
                                                : '0'}
                                        </div>
                                        <div className="report-subtitle">Per booking</div>
                                    </div>
                                </div>

                                {/* Revenue by Apartment */}
                                <div className="chart-container">
                                    <h3 className="chart-title">Revenue by Apartment</h3>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                                        {apartments.map(apartment => {
                                            const aptRevenue = bookings
                                                .filter(b => b.apartmentId === apartment.id && b.status !== 'cancelled')
                                                .reduce((sum, b) => sum + (b.amountPaid || 0), 0);
                                            const aptBookings = bookings.filter(b => b.apartmentId === apartment.id && b.status !== 'cancelled').length;
                                            
                                            return (
                                                <div key={apartment.id} style={{ background: '#f9fafb', padding: '1rem', borderRadius: '0.5rem' }}>
                                                    <div style={{ fontWeight: '600', marginBottom: '0.5rem' }}>{apartment.name}</div>
                                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#2E3192' }}>
                                                        ‚Ç¶{aptRevenue.toLocaleString()}
                                                    </div>
                                                    <div style={{ fontSize: '0.875rem', color: '#6b7280', marginTop: '0.25rem' }}>
                                                        {aptBookings} bookings
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Top Agents */}
                                <div className="chart-container">
                                    <h3 className="chart-title">Top Performing Agents</h3>
                                    <div style={{ display: 'grid', gap: '0.5rem' }}>
                                        {(() => {
                                            const agentStats = {};
                                            bookings.forEach(b => {
                                                if (b.status !== 'cancelled') {
                                                    if (!agentStats[b.agentName]) {
                                                        agentStats[b.agentName] = { count: 0, revenue: 0 };
                                                    }
                                                    agentStats[b.agentName].count += 1;
                                                    agentStats[b.agentName].revenue += b.amountPaid || 0;
                                                }
                                            });
                                            
                                            return Object.entries(agentStats)
                                                .sort((a, b) => b[1].revenue - a[1].revenue)
                                                .slice(0, 5)
                                                .map(([agent, stats]) => (
                                                    <div key={agent} style={{ 
                                                        display: 'flex', 
                                                        justifyContent: 'space-between', 
                                                        alignItems: 'center',
                                                        padding: '0.75rem',
                                                        background: '#f9fafb',
                                                        borderRadius: '0.5rem'
                                                    }}>
                                                        <div>
                                                            <div style={{ fontWeight: '600' }}>{agent}</div>
                                                            <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                                                {stats.count} bookings
                                                            </div>
                                                        </div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: '700', color: '#2E3192' }}>
                                                            ‚Ç¶{stats.revenue.toLocaleString()}
                                                        </div>
                                                    </div>
                                                ));
                                        })()}
                                    </div>
                                </div>

                                {/* Recent Bookings Summary */}
                                <div className="chart-container">
                                    <h3 className="chart-title">Booking Status Summary</h3>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem' }}>
                                        {['pending', 'confirmed', 'checked-in', 'completed', 'cancelled'].map(status => {
                                            const count = bookings.filter(b => b.status === status).length;
                                            const colors = {
                                                pending: '#f59e0b',
                                                confirmed: '#3b82f6',
                                                'checked-in': '#10b981',
                                                completed: '#6b7280',
                                                cancelled: '#ef4444'
                                            };
                                            
                                            return (
                                                <div key={status} style={{ 
                                                    background: '#f9fafb', 
                                                    padding: '1rem', 
                                                    borderRadius: '0.5rem',
                                                    textAlign: 'center'
                                                }}>
                                                    <div style={{ 
                                                        fontSize: '2rem', 
                                                        fontWeight: '700', 
                                                        color: colors[status] 
                                                    }}>
                                                        {count}
                                                    </div>
                                                    <div style={{ 
                                                        fontSize: '0.875rem', 
                                                        color: '#6b7280',
                                                        textTransform: 'capitalize',
                                                        marginTop: '0.25rem'
                                                    }}>
                                                        {status}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Expenses Tab (Admin Only) */}
                        {activeTab === 'expenses' && isAdmin && (
                            <div>
                                <div className="section-header">
                                    <h2 className="section-title">Expense Management</h2>
                                    {!showExpenseForm && (
                                        <button
                                            onClick={() => {
                                                setShowExpenseForm(true);
                                                setEditingExpense(null);
                                                setExpenseForm({
                                                    apartmentId: '',
                                                    expenseType: 'electricity',
                                                    description: '',
                                                    amount: '',
                                                    date: new Date().toISOString().split('T')[0],
                                                    notes: ''
                                                });
                                            }}
                                            className="btn btn-primary"
                                        >
                                            <Plus />
                                            <span>Add Expense</span>
                                        </button>
                                    )}
                                </div>

                                {showExpenseForm && (
                                    <div className="card" style={{ marginBottom: '2rem' }}>
                                        <h3 style={{ fontSize: '1.25rem', fontWeight: '700', marginBottom: '1.5rem' }}>
                                            {editingExpense ? 'Edit Expense' : 'Add New Expense'}
                                        </h3>
                                        
                                        <form onSubmit={handleExpenseSubmit}>
                                            <div className="form-grid">
                                                <div className="form-group">
                                                    <label className="form-label">Apartment *</label>
                                                    <select
                                                        value={expenseForm.apartmentId}
                                                        onChange={(e) => setExpenseForm({ ...expenseForm, apartmentId: e.target.value })}
                                                        required
                                                    >
                                                        <option value="">Select apartment</option>
                                                        <option value="general">General (Not specific to apartment)</option>
                                                        {apartments.map(apt => (
                                                            <option key={apt.id} value={apt.id}>{apt.name}</option>
                                                        ))}
                                                    </select>
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Expense Type *</label>
                                                    <select
                                                        value={expenseForm.expenseType}
                                                        onChange={(e) => setExpenseForm({ ...expenseForm, expenseType: e.target.value })}
                                                        required
                                                    >
                                                        <option value="electricity">Electricity</option>
                                                        <option value="water">Water</option>
                                                        <option value="diesel">Diesel</option>
                                                        <option value="maintenance">Maintenance</option>
                                                        <option value="cleaning">Cleaning</option>
                                                        <option value="repairs">Repairs</option>
                                                        <option value="supplies">Supplies</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Date *</label>
                                                    <input
                                                        type="date"
                                                        value={expenseForm.date}
                                                        onChange={(e) => setExpenseForm({ ...expenseForm, date: e.target.value })}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Amount (‚Ç¶) *</label>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={expenseForm.amount}
                                                        onChange={(e) => setExpenseForm({ ...expenseForm, amount: e.target.value })}
                                                        className="form-input"
                                                        required
                                                        placeholder="0.00"
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Description *</label>
                                                    <input
                                                        type="text"
                                                        value={expenseForm.description}
                                                        onChange={(e) => setExpenseForm({ ...expenseForm, description: e.target.value })}
                                                        className="form-input"
                                                        required
                                                        placeholder="e.g., Monthly electricity bill"
                                                    />
                                                </div>

                                                <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                                                    <label className="form-label">Notes</label>
                                                    <textarea
                                                        value={expenseForm.notes}
                                                        onChange={(e) => setExpenseForm({ ...expenseForm, notes: e.target.value })}
                                                        className="form-input"
                                                        rows="3"
                                                        placeholder="Additional details..."
                                                    />
                                                </div>
                                            </div>

                                            <div style={{ display: 'flex', gap: '1rem', marginTop: '1.5rem' }}>
                                                <button type="submit" className="btn btn-primary">
                                                    {editingExpense ? 'Update Expense' : 'Save Expense'}
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        setShowExpenseForm(false);
                                                        setEditingExpense(null);
                                                    }}
                                                    className="btn btn-secondary"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                )}

                                {/* Expense Summary Cards */}
                                <div className="stats-grid" style={{ marginBottom: '2rem' }}>
                                    <div className="stat-card">
                                        <div className="stat-content">
                                            <div>
                                                <p className="stat-label">Total Expenses (This Month)</p>
                                                <p className="stat-value">
                                                    ‚Ç¶{expenses.filter(e => {
                                                        const expenseDate = new Date(e.date);
                                                        const now = new Date();
                                                        return expenseDate.getMonth() === now.getMonth() && 
                                                               expenseDate.getFullYear() === now.getFullYear();
                                                    }).reduce((sum, e) => sum + (e.amount || 0), 0).toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="stat-card">
                                        <div className="stat-content">
                                            <div>
                                                <p className="stat-label">Electricity This Month</p>
                                                <p className="stat-value">
                                                    ‚Ç¶{expenses.filter(e => {
                                                        const expenseDate = new Date(e.date);
                                                        const now = new Date();
                                                        return e.expenseType === 'electricity' &&
                                                               expenseDate.getMonth() === now.getMonth() && 
                                                               expenseDate.getFullYear() === now.getFullYear();
                                                    }).reduce((sum, e) => sum + (e.amount || 0), 0).toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="stat-card">
                                        <div className="stat-content">
                                            <div>
                                                <p className="stat-label">Total Expenses (All Time)</p>
                                                <p className="stat-value">
                                                    ‚Ç¶{expenses.reduce((sum, e) => sum + (e.amount || 0), 0).toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Expenses List */}
                                <div className="card">
                                    <h3 style={{ fontSize: '1.25rem', fontWeight: '700', marginBottom: '1.5rem' }}>
                                        All Expenses ({expenses.length})
                                    </h3>

                                    {expenses.length === 0 ? (
                                        <p style={{ textAlign: 'center', color: '#9ca3af', padding: '3rem' }}>
                                            No expenses recorded yet. Click "Add Expense" to get started.
                                        </p>
                                    ) : (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                            {expenses
                                                .sort((a, b) => new Date(b.date) - new Date(a.date))
                                                .map(expense => {
                                                    const apartment = expense.apartmentId === 'general' 
                                                        ? { name: 'General' } 
                                                        : apartments.find(a => a.id === expense.apartmentId);
                                                    
                                                    return (
                                                        <div key={expense.id} className="booking-card">
                                                            <div className="booking-card-header">
                                                                <div>
                                                                    <h4 style={{ fontSize: '1.125rem', fontWeight: '600', color: '#1f2937', marginBottom: '0.25rem' }}>
                                                                        {expense.description}
                                                                    </h4>
                                                                    <p style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                                                        {apartment?.name || 'Unknown'} {expense.apartmentId !== 'general' ? 'Apartment' : ''} ‚Ä¢ {new Date(expense.date).toLocaleDateString()}
                                                                    </p>
                                                                </div>
                                                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                                    <span style={{ 
                                                                        padding: '0.5rem 1rem',
                                                                        background: 'linear-gradient(135deg, #2E3192 0%, #F15A29 100%)',
                                                                        color: 'white',
                                                                        borderRadius: '0.5rem',
                                                                        fontWeight: '700',
                                                                        fontSize: '1.125rem'
                                                                    }}>
                                                                        ‚Ç¶{expense.amount.toLocaleString()}
                                                                    </span>
                                                                    <button
                                                                        onClick={() => handleEditExpense(expense)}
                                                                        className="icon-btn icon-btn-blue"
                                                                        title="Edit"
                                                                    >
                                                                        <Edit />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => handleDeleteExpense(expense.id)}
                                                                        className="icon-btn icon-btn-red"
                                                                        title="Delete"
                                                                    >
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            <div className="booking-details-grid">
                                                                <div className="detail-item">
                                                                    <p className="detail-label">Type</p>
                                                                    <p className="detail-value" style={{ textTransform: 'capitalize' }}>
                                                                        {expense.expenseType}
                                                                    </p>
                                                                </div>
                                                                {expense.notes && (
                                                                    <div className="detail-item" style={{ gridColumn: '1 / -1' }}>
                                                                        <p className="detail-label">Notes</p>
                                                                        <p className="detail-value">{expense.notes}</p>
                                                                    </div>
                                                                )}
                                                                <div className="detail-item">
                                                                    <p className="detail-label">Recorded By</p>
                                                                    <p className="detail-value">{expense.createdBy}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<BookingManager />, document.getElementById('root'));
    </script>
</body>
</html>